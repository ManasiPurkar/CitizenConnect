FROM openjdk:21
WORKDIR /app
COPY ./APIGateway /app
COPY ./APIGateway/target/APIGateway-0.0.1-SNAPSHOT.jar ./

# Install ngrok
# RUN wget https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-amd64.zip \
#    && unzip ngrok-v3-stable-linux-amd64.zip \
#    && mv ngrok /usr/local/bin/ 

RUN curl -o ngrok.zip https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-stable-linux-amd64.zip \
    && unzip ngrok.zip \
    && mv ngrok /usr/local/bin/ \
    && rm ngrok.zip
    
RUN ngrok authtoken 2bexTFg5VNQNuyBAHXJBrPTwhOR_fJhk6PLTAZFiSXKPTDdq

EXPOSE 9093

# NGROK_AUTHTOKEN=2bexTFg5VNQNuyBAHXJBrPTwhOR_fJhk6PLTAZFiSXKPTDdq ngrok/ngrok:latest http --domain=6194-103-156-19-229.ngrok-free.app 9093

# Run Ngrok in the background with the provided public IP and port 9093
CMD ./ngrok http --bind-tls=true 6194-103-156-19-229.ngrok-free.app:9093 & java -jar APIGateway-0.0.1-SNAPSHOT.jar
