version: '3'


# Define the DOCKER_NAMESPACE environment variable 
# This variable will be available to all services
environment:
  DOCKER_NAMESPACE: ${DOCKER_NAMESPACE}


services:
  serviceregistry:
    image: ${DOCKER_NAMESPACE}/citizenconnect:serviceregistry
    container_name: serviceregistry
    ports:
      - "8761:8761"
    networks:
      - citizenconnect

  apigateway:
    image: ${DOCKER_NAMESPACE}/citizenconnect:apigateway
    container_name: apigateway
    ports:
      - "9093:9093"
    networks:
      - citizenconnect
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eurekaregistry:8761/eureka/
      - DOCKER_NAMESPACE=${DOCKER_NAMESPACE}
    depends_on:
      - serviceregistry

  userservice:
    image: ${DOCKER_NAMESPACE}/citizenconnect:userservice
    container_name: userservice
    ports:
      - "9091:9091"
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eurekaregistry:8761/eureka/
      - SPRING_DATASOURCE_URL=jdbc:mysql://userservice_db/User_Service?createDatabaseIfNotExist=true
      - SPRING_DATASOURCE_USERNAME=root
      - SPRING_DATASOURCE_PASSWORD=ManasiP@123
      - DOCKER_NAMESPACE=${DOCKER_NAMESPACE}
    networks:
      - citizenconnect
    depends_on:
      - serviceregistry
      - apigateway
      - userservice_db
    volumes:
      - /home/documents/github/CitizenConnectLogs:/logs

  complaintservice:
    image: ${DOCKER_NAMESPACE}/citizenconnect:complaintservice
    container_name: complaintservice
    ports:
      - "9092:9092"
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eurekaregistry:8761/eureka/
      - SPRING_DATASOURCE_URL=jdbc:mysql://complaintservice_db/Complaint_Service?createDatabaseIfNotExist=true
      - SPRING_DATASOURCE_USERNAME=root
      - SPRING_DATASOURCE_PASSWORD=ManasiP@123
      - DOCKER_NAMESPACE=${DOCKER_NAMESPACE}
    networks:
      - citizenconnect
    depends_on:
      - serviceregistry
      - apigateway
      - complaintservice_db
    volumes:
      - /home/documents/github/CitizenConnectLogs:/logs

  userservice_db:
    image: mysql:8
    container_name: userservice_db
    ports:
      - "3308:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_DATABASE=userservice
    volumes:
      - userservice_db:/var/lib/mysql
    networks:
      - splitwise

  expenseservice_db:
    image: mysql:8
    container_name: expenseservice_db
    ports:
      - "3307:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_DATABASE=expenseservice
    volumes:
      - expenseservice_db:/var/lib/mysql
    networks:
      - splitwise

  splitwisefrontend:
    image: ${DOCKER_NAMESPACE}/splitwise:splitwisefrontend
    container_name: splitwisefrontend
    ports:
      - "3000:3000"
    networks:
      - splitwise

networks:
  splitwise:
    driver: bridge

volumes:
  expenseservice_db:
  userservice_db:


